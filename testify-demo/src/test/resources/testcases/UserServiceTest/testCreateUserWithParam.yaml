variables:
  userId: "test-12345"
  userName: "${faker.name().firstName()}"
  email: test@example.com
  nowTime: ${time.now()}

input:
  users: { userId: '${userId}',
           userName: '${userName}',
           email: test@example.com }


setup:
  clean_sql: DELETE FROM users WHERE user_id = '${userId}';
#  db_setup:
#    - table: users
#      data: # 模式 A：直接定义数据行
#        - user_id: ${userId}
#          user_name: "Admin"
mocks:
  # 场景1：基础 Mock，匹配任意入参，返回动态生成的随机数据
  - bean: "orderService"
    args:
      orderId: "${userId}"
      orderName: "${userName}"
    method: "createOrder"
    #    thenThrow:
    #      type: 'java.lang.IllegalArgumentException'
    #      message: 'Simulated exception for userId: ${userId}'
    thenReturn:
      orderId: "${userId}"
      orderName: ${userName}

expect:
  #  exception:
  #    type: 'java.lang.IllegalArgumentException'
  #    message: 'User ID cannot be empty'
  # 预期响应结果
  response:
    userId: "${userId}"
    userName: ${userName}
    createdAt:
      op: approx
      val: ${nowTime}
    order:
      orderId: ${userId}
      orderName: ${userName}
  database:
    table: users
    mode: strict
    rows:
      - _match: { user_id: "${userId}" }
        user_name:
          op: contains
          val: ${userName}
        email:
          op: regex
          val: .+@example\.com
        status: ACTIVE
        created_at:
          op: approx
          val: ${nowTime}